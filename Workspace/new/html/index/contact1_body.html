<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>添加联系人1</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/common.css" />
  <style type="text/css">
        *{
            margin: 0;
            padding: 0;
        }
        body{
            font-family: "微软雅黑",arial;
            font-size: 12px;
            position: absolute;
            bottom: 0;
        }
        /*header*/
        #headers{
            width: 100%;
            margin-top: 24px;
        }
        #headers .info_list{
            margin-left: 12px;
            margin-right: 12px;
        }
        #headers .info_list .list_1{
            height: 54px;
            border-bottom: 1px solid #D7D7D7;
        }
        #headers .info_list .list_1 .icon_1{
            width: 30px;
            height: 30px;
            border: 1px solid #D7D7D7;
            border-radius: 50%;
            margin-top: 12px;
            display: block;
            float: left;
        }
        .names{
            height: 54px;
            outline: none;
            float: left;
            font-size: 14px;
            text-indent: 14px;
            width: 80%;
            color: #333;
            font-family: '微软雅黑';
        }
        #btns{
            height: 50px;
            background: #c9c9c9;
            margin-left: 12px;
            margin-right: 12px;
            display: block;
            color: #fff;
            font-size: 16px;
            text-align: center;
            line-height: 50px;
            margin-top: 44px;
            border-radius: 6px;
        }
        .list_1 .tmt{
            position: absolute;
            left: 58px;
            color: #999;
        }
        .sels1{
            height: 16px;
            width: 16px;
            border: 1px solid red;
            float: right;
            margin-top: 19px;
            line-height: 16px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="headers">
        <div class="info_list">
            <div class="list_1">
                <span class="icon_1"></span>
                <input type="text" placeholder="姓名" class="names" id="one_name" />
            </div>
            <!-- list2 -->
            <div class="list_1">
                <span class="icon_1"></span>
                <input type="text" placeholder="关系" class="names" id="one_relation" />
                <!--<div class="sels1">V</div>-->
            </div>
            <!-- list3 -->
            <div class="list_1">
                <span class="icon_1"></span>
                <input type="tel" placeholder="手机号码" maxlength="11" class="names" id="one_phone"  />
            </div>
            <!-- list4 -->
            <div class="list_1">
                <span class="icon_1"></span>
                <input type="text" placeholder="工作单位" class="names" id="one_company"  />
            </div>
            <!-- list5 -->
            <div class="list_1">
                <span class="icon_1"></span>
                <input type="text" placeholder="联系地址" class="names" id="one_address" />
            </div>
        </div>
        <a href="javascript:void(0);" id="btns" tapmode="" onclick="submit()">确定</a>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript">
	$api.addEvt($api.dom('#headers'),'keyup',function(){
		checkButton(this);	
	});
	/**
	 *检查按钮和输入是否为空！ 
	 */
	var checkButton=function(obj){
		var name=$api.val($api.byId('one_name'));
		var relation=$api.val($api.byId('one_relation'));
		var phone=$api.val($api.byId('one_phone'));
		var company=$api.val($api.byId('one_company'));
		var address=$api.val($api.byId('one_address'));
		if($api.trimAll(name)!='' && $api.trimAll(relation)!='' && $api.trimAll(phone)!='' && $api.trimAll(company)!='' && $api.trimAll(address)!=''){
			$api.attr($api.byId("btns"),'style','background:#0da4ff');
		}else{
			$api.attr($api.byId("btns"),'style','background:#c9c9c9');
		}
	}
	/**
	 *提交表单 
	 */
	var submit=function(){
		var name=$api.val($api.byId('one_name'));
		var relation=$api.val($api.byId('one_relation'));
		var phone=$api.val($api.byId('one_phone'));
		var company=$api.val($api.byId('one_company'));
		var address=$api.val($api.byId('one_address'));
		if($api.trimAll(name)==''){api.toast({msg:'记得填写姓名哦！'})}
		else if($api.trimAll(relation)==''){api.toast({msg:'关系-要填写哦！'})}
		else if($api.trimAll(phone)=='' || $api.trimAll(phone).length!=11){api.toast({msg:'手机号码不对哦！'})}
		else if($api.trimAll(company)==''){api.toast({msg:'工作单位是空的哦！'})}
		else if($api.trimAll(address)==''){api.toast({msg:'住址没填写哦！'})}
		else{
			/*存入prefs*/
			api.setPrefs({key:'one_name',value:name});
			api.setPrefs({key:'one_relation',value:relation});
			api.setPrefs({key:'one_phone',value:phone});
			api.setPrefs({key:'one_company',value:company});
			api.setPrefs({key:'one_address',value:address});
			api.getPrefs({
		        key:'userid'
	        },function(ret,err){
	        	if(ret){
	        		if(api.connectionType=='none'){
	        			api.toast({
	                        msg:'无网络连接'
                        });
                        return false;
	        		}
	        		var vipid=ret.value;
	        		api.ajax({
	                    url:'http://192.168.0.188:8899/index.php/borrow/contactone',
	                    method:'post',
	                    dataType:'json',
	                    returnAll:true,
	                    data:{values:{
	                    	vipid:vipid,
	                    	one_name:$api.trimAll(name),
	                    	one_relation:$api.trimAll(relation),
	                    	one_phone:$api.trimAll(phone),
	                    	one_company:$api.trimAll(company),
	                    	one_address:$api.trimAll(address),
	                    	one_status:1
	                    }}
                    },function(ret,err){
                    	if(ret.statusCode!=200){
                    		api.showProgress({
                    			animationType:'fade',
                    			title:'提交中···',
                    			text:'静等片刻···',
                    			modal:false
                            });
                    	}else{
                    		api.hideProgress();
                    	}
                    	if(ret.body.result==true){
                    		api.toast({
	                            msg:'联系人1提交成功！'
                            });
                            api.execScript({
                            	name:'friend',
                            	frameName:'friend_body',
	                            script: 'reload();'
                            });
                            setTimeout(function(){
	                            api.closeWin({
	                            	name:'contact1'
	                            });
	                        },1000);
                    	}else{
                    		api.toast({
	                            msg:'信息提交失败~'
                            });
                    	}
                    });
	        	}else{
	        		api.toast({
		                msg:'数据异常，请重新输入！'
	                });
	        	}
	        });
	     }
	}
	var openWin=function($url){
		api.openWin({
	        name:$url,
	        url: $url+'.html',
	        bgcolor:"#ffffff",
	        scrollToTop:true,
	        animation:{
	        	type:'movein',
	        	subType:'from_right'
	        }
        });
	}
	apiready=function(){
		api.getPrefs({key:'one_name'},function(ret,err){if(ret){$api.val($api.byId("one_name"),ret.value)}});
		api.getPrefs({key:'one_relation'},function(ret,err){if(ret){$api.val($api.byId("one_relation"),ret.value)}});
		api.getPrefs({key:'one_phone'},function(ret,err){if(ret){$api.val($api.byId("one_phone"),ret.value)}});
		api.getPrefs({key:'one_company'},function(ret,err){if(ret){$api.val($api.byId("one_company"),ret.value)}});
		api.getPrefs({key:'one_address'},function(ret,err){if(ret){$api.val($api.byId("one_address"),ret.value)}});
	}
</script>
</html>