<!DOCTYPE>
<html>
 <head>
  <title>贪吃蛇游戏-赵鑫焱制作</title>
  <meta name="Generator" content="EditPlus">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <style text="text/css">
		*{margin:0;padding:0}
		body,html,div,p,input{margin:0;padding:0}
		body{font-size:14px;color:#660099;font-family:"微软雅黑";background:#99ff66;}
		
	 h1{font-size:30px;text-align:center;text-shadow:2px 5px 5px rgba(0,0,0,1);color:#ffffff}
	 .info{
		font-size:16px;text-align:center;text-shadow:2px 5px 5px rgba(0,0,0,1);color:#0000ff
	 }
  </style>
 </head>
 <body>
	<h1>贪吃蛇游戏-赵鑫焱</h1>
	
 <div align=center>
 <div class="info">分数：<span id="score" ></span> 速度:<span id="speed" ></span></div>
  <canvas align=center id="myCanvas" width="450" height="450" style="border:1px solid #66ff00;background:#663300" ></canvas>
  <AUDIO src="/demo/js+jquery/she/bg.mp3" id="bgb" ></AUDIO>
  <script type="text/javascript">
    
  /**
  第一部分(看到可见的表格)
  1.绘制表格，长30，宽30，格子宽度15,所以canvas为450的正方形
  2.在第一行绘制蛇
  3.在最中心绘制食物
  （一个静态页面完成）
   


  第二部分（让蛇可以运动起来）
   1.让蛇头可以随着键盘的上下左右动起来(尾部先不管)document.onkeydown = function(e)
     这时候要创建蛇对象，食物对象

   2.让尾巴跟随头一起运动
      算法：1.产生新的蛇头（根据现在蛇头的方向和按键的方向）
	        2.产生新的蛇身（不要最后的蛇尾（蛇的最后一节），复制其余的）
			3.把新的蛇头增加的蛇身上，成为一条新蛇

   3.让蛇可以吃食物
      1.增加蛇长度
	  2.产生新的食物
      3.改变原来食物的颜色为蛇的颜色

 第三部分(自动运动，判断蛇的死亡，计费等完善)
   
  **/

  
  //定义节点对象
  //x，y,f：方向 (1左，-1右，2上，-2下)
  function Cell(x,y,f) {
    this.x = x;
	this.y = y;
	this.f = f;
	return this;
  }


  //食物对象
  function Food(x,y) {
    this.x = x;
	this.y = y;
	return this;
  }

  var c=document.getElementById("myCanvas");
  var cxt=c.getContext("2d");
  var score = 0;
  var speed = 500;
  //节点宽度
  var width =15;
  
  //初始蛇长度
  var len=6;

  //第一个食物产生点
  var food = new Food(15,15);

  
  //初始蛇对象（往右横着出来）
  var snake =[];
  for(var i=0;i<len;i++) {
    snake[i] = new Cell(i,0,-1);
  }

  //取得蛇的头
  var head = snake[len-1];
 

   //绘图方法  
  function draw() {
	 
	 //绘图前清空
	 cxt.clearRect(0,0,450,450);
	
    //绘制表格的横线
	for(var i=0;i<30;i++) {
		cxt.strokeStyle="white";
		cxt.beginPath();
		cxt.moveTo(0,i*width);
		cxt.lineTo(450,i*width);
		cxt.closePath();
		cxt.stroke();
	
	}

	//绘制表格的竖线
	for(var i=0;i<30;i++) {
		
		cxt.beginPath();
		cxt.moveTo(i*width,0);
		cxt.lineTo(i*width,450);
		cxt.closePath();
		cxt.stroke();
	
	}

cxt.strokeStyle="#0066ff";
  //绘制蛇对象
  for(var i=0;i<snake.length;i++) {
	cxt.fillStyle='black';
	if(i==snake.length-1){
		cxt.fillStyle='#99ff00';
	}
	
	cxt.beginPath();
	cxt.rect(snake[i].x*width,snake[i].y*width,15,15);
	cxt.closePath();
	cxt.fill();
	cxt.stroke();
  }
 

	//随机产生个食物
	cxt.fillStyle='yellow';
	cxt.beginPath();
	cxt.rect(food.x*width,food.y*width,15,15);
	cxt.closePath();
	cxt.fill();
document.getElementById("score").innerHTML=score;
		document.getElementById("speed").innerHTML=speed/1000+"s/c";
	

      //如果吃到了食物
	  if(head.x==food.x&&head.y==food.y) {
	document.getElementById("bgb").play();
	   //清空食物
		cxt.fillStyle='black';
		cxt.beginPath();
		cxt.rect(food.x*width,food.y*width,15,15);
		cxt.closePath();
		cxt.fill();

        //产生新的食物
		 initFoodXY();
        food = new Food(footX,footY)
		cxt.fillStyle='yellow';
		cxt.beginPath();
		cxt.rect(food.x*width,food.y*width,15,15);
		cxt.closePath();
		cxt.fill();

		//长度+1
        var newCell = new Cell(head.x,head.y,head.f);
		switch(head.f){
			case 2 :newCell.y--;break;//上
			case -1:newCell.x++ ;break;//右
			case -2:newCell.y++ ;break;//下
			case 1:newCell.x-- ;break;//左
		}


        //把新节点增加的头部
		snake[snake.length] = newCell;
		//让新节点覆盖成为头部
		head = newCell;
		speed-=10;
		score+=10;
		document.getElementById("score").innerHTML=score;
		document.getElementById("speed").innerHTML=speed/1000+"c/s";
     }

  }

  draw();


  //键盘事件
  document.onkeydown = function(e) { //改变蛇方向
	var code = e.keyCode - 37;
	var direction ;
	switch(code){
		case 1 : direction = 2;break;//上
		case 2 : direction = -1;break;//右
		case 3 : direction = -2;break;//下
		case 0 : direction = 1;break;//左
	}
	
	//0<=code&&code<=3 只监听上下左右四个按键，并且不能反方向运动（不能倒退）
	if(parseInt(head.f)+direction!=0&&0<=code&&code<=3) {
		moveSnake(direction);
	}
}

//随机产生食物
function initFoodXY() {
         footX =  Math.ceil(Math.random()*28)+1;
		 footY = Math.ceil(Math.random()*28)+1;

		 //如果食物和蛇的位置重合，从新产生食物(递归)
		 for(var i=0;i<snake.length;i++) {
		    if(snake[i].x==footX&&snake[i].y==footY) {
				initFoodXY();
			}
		 }
}

//移动蛇的方法
function moveSnake(diretion){
	
	var newSnake = [];
	var newCell = new Cell(head.x,head.y,head.f);

	for(var i=1;i<snake.length;i++) {
		
	  newSnake[i-1] = snake[i];
	
	}
	newSnake[snake.length-1] = newCell;

	
	newCell.f = diretion;
	switch(diretion){
		case 2 :newCell.y--;break;//上
		case -1:newCell.x++ ;break;//右
		case -2:newCell.y++ ;break;//下
		case 1:newCell.x-- ;break;//左
	}
	
   
     
	snake = newSnake;
     head = snake[snake.length-1];


    checkDeath();
   
	draw();
}

//判断是不是挂了
function checkDeath() {
	if(head.x>=30||head.y>=30||head.x<0||head.y<0) {
		alert("Game Over!");
		window.location.reload();
	}

	for(var i=0;i<snake.length-1;i++) {
		if(head.x==snake[i].x&&head.y==snake[i].y) {
			alert("Game Over!");
		window.location.reload();
		
		}
	}

}

//每个300毫秒自动调用
 function moveClock() {

	moveSnake(head.f);
 
 }

 setInterval(moveClock,speed);
  </script>
  </div>
 </body>
</html>
