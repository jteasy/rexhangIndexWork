<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>我的伙伴</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/common.css" />
    <style type="text/css">
        *{
            margin: 0;
            padding: 0;
        }
        body{
            font-size: 12px;
            font-family: "Helvetica Neue", Helvetica, STHeiTi, sans-serif;
        }
        .titles{
            width: 100%;
            color: #999;
            background: #D8D8D8;
            height: 24px;
            line-height: 24px;
            text-align: center;
        }
        .container{
            width: 100%;
        }
        .container .content{
            margin: 10px 16px 0 16px;
        }
        .container .content .btn1{
            height: 45px;
            background: #0DA4FF;
            font-size: 16px;
            text-align: center;
            line-height: 45px;
            color: #fff;
            border-radius: 4px; 
        }
        .mag{
            margin-top: 14px;
        }
        #btns{
            margin: 10px 16px 0 16px;
        }
        #btns .btn_sure{
            height: 50px;
            background: #C9C9C9;
            font-size: 18px;
            text-align: center;
            line-height: 50px;
            color: #fff;
            border-radius: 4px;
            margin-top: 54px;
        }
        #btns .btn_bg{
            background: #0DA4FF;
        }
        
        .ctn{
            width: 100%;
            background-color: #EFEFF2;
        }
        .tit{
            margin: 0 10%;
            color: #999;
            text-align: center;
            font-size: 12px;
            line-height: 24px;
        }
        .cons{
            width: 100%;
            background: #fff;
        }
        .con{
            margin: 0 5%;
            position: relative;
            padding: 10px 0;
        }
        .con2{
            margin: 0 5%;
            position: relative;
            padding: 20px 0;
        }
        .name1{
            font-size: 16px;
            color: #333;
        }
        .pfon{
            color: #999;
            font-size:16px;
            line-height: 24px;
            word-break: keep-all;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .rights{
            width: 12px;
            height: 20px;
            display: block;
            background: url('../../image/right_arrow.png') no-repeat;
            background-size: 100%;
            position: absolute;
            right: 0;
            top: 32px;
        }
        .rights2{
            width: 12px;
            height: 20px;
            display: block;
            background: url('../../image/right_arrow.png') no-repeat;
            background-size: 100%;
            position: absolute;
            right: 0;
            top: 21px;
        }
        hr{
            height: 12px;
            background: #EFEFF2;
            border: 0;
        }
        #btn{
            width: 100%;
            height: 50px;
        }
        .btns{
            margin: 0 5%;
            background: #0DA4FF;
            height: 50px;
            font-size: 16px;
            color: #fff;
            text-align: center;
            line-height: 50px;
            border-radius: 4px;
            margin-top: 70px;
        }
        .aleft{
            margin-left: 50px;
        }
    </style>
</head>
<body>
    <div class="titles">需要您添加四位联系人，且其中第一位为直系亲属</div>
    <div class="container">
	   	<!--在此处添加用户提交后的信息-->

	    <!--添加用户提交后的信息结束-->
	     
		<div id="temp">
            <div class="content">
                <div class="btn1" id="contact_one" tapmode="" onclick="openWin('contact1')">添加联系人 1</div>         
                <div class="btn1 mag" id="contact_two" tapmode="" onclick="openWin('contact2')">添加联系人 2</div>
                <div class="btn1 mag" id="contact_three" tapmode="" onclick="openWin('contact3')">添加联系人 3</div>
                <div class="btn1 mag" id="contact_four" tapmode="" onclick="openWin('contact4')">添加联系人 4</div>
            </div>
            <input type="hidden" id="btn-flag" value="0"/>
            <div id="btns">
                <div class="btn_sure" tapmode="btn_bg" onclick="submit()">确认</div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript">
	//提交表单
	var submit=function(){
		var flag=$api.val($api.byId("btn-flag"));
		if (flag==0){
			return false;
		}else{
            $api.setStorage('contact_status',true);
			api.execScript({
	            name:'information',
	            frameName:'information_body',
	            script: 'reload();'
            });
            api.openWin({
                name: 'information',
                reload:true
            });
			api.closeWin({
				name:'friend'
            });
		}
	}
	var openWin=function($url){
		api.openWin({
	        name:$url,
	        url: $url+'_header.html',
	        bgcolor:"#ffffff",
	        scrollToTop:true,
	        animation:{
	        	type:'movein',
	        	subType:'from_right'
	        }
        });
	}
	//被远程执行，重新刷新当前页面的方法：
	var reload=function(){
		getFriendInfo();
	}
	apiready=function(){
		getFriendInfo();
	}
	//获取用户已填写的信息：
	var getFriendInfo=function(){
            var temp=$api.html($api.byId('temp'));
                temp='<div id="temp">'+temp+'</div>';
            $api.html($api.dom('.container'),temp);
		//优先获取本地存储的数据，如果本地存储的数据不存在，那么再去获取网络数据
	           	var baseinfo=$api.getStorage('baseinfo');
                var contact4 = $api.getStorage('contact4');
                var contact3 = $api.getStorage('contact3');
                var contact2 = $api.getStorage('contact2');
                var contact1 = $api.getStorage('contact1');

                    if(baseinfo.contact && baseinfo.contact.four_status==true && baseinfo.contact.three_status==true && baseinfo.contact.two_status==true && baseinfo.contact.one_status==true){
                            //控制按钮颜色
                            $api.attr($api.dom('.btn_sure'),'style','background:#0da4ff');
                            $api.val($api.byId('btn-flag'),1);    
	        		}else{
                        if(baseinfo.contact){
                            //根据index的基础信息来判断四个状态
                            if(baseinfo.contact.four_status){
                                four_status = true;
                            }else{
                                if(contact4 && (contact4.four_status==true || contact4.four_status=='true')){
                                    four_status = true;
                                }else{
                                    four_status = false;
                                }
                            }
                            if(baseinfo.contact.three_status){
                                three_status = true;
                            }else{
                                 if(contact3 && (contact3.three_status==true || contact3.three_status=='true')){
                                    three_status = true;
                                }else{
                                    three_status = false;
                                }
                            }
                            if(baseinfo.contact.two_status){
                                two_status = true;
                            }else{
                                if(contact2 && (contact2.two_status==true || contact2.two_status=='true')){
                                    two_status = true;
                                }else{
                                    two_status = false;
                                }
                            }
                            if(baseinfo.contact.one_status){
                                one_status = true;
                            }else{
                                if(contact1 && (contact1.one_status==true || contact1.one_status=='true')){
                                    one_status = true;
                                }else{
                                    one_status = false;
                                }
                            }
                            
                        }else{      //如果上面的判断不存在，那么就根据本地缓存来判断
                            if(contact4 && (contact4.four_status==true || contact4.four_status=='true')){
                                four_status = true;
                            }else{
                                four_status = false;
                            }
                            if(contact3 && (contact3.three_status==true || contact3.three_status=='true')){
                                three_status = true;
                            }else{
                                three_status = false;
                            }
                            if(contact2 && (contact2.two_status==true || contact2.two_status=='true')){
                                two_status = true;
                            }else{
                                two_status = false;
                            }
                            if(contact1 && (contact1.one_status==true || contact1.one_status=='true')){
                                one_status = true;
                            }else{
                                one_status = false;
                            }
                        }
                        if(four_status && three_status && two_status && one_status){
                            $api.attr($api.dom('.btn_sure'),'style','background:#0da4ff');
                             $api.val($api.byId('btn-flag'),1);    
                        }else{
                             $api.attr($api.dom('.btn_sure'),'style','background:#c9c9c9');
                                $api.val($api.byId('btn-flag'),0);
                        }
                    }
                        if($api.getStorage('contact4')!='' && $api.getStorage('contact4')!=null){
                            var contact4 = $api.getStorage('contact4');
                              var appendstr="";
                              		appendstr+='<div class="con2" tapmode="" onclick="openWin('+"'contact4'"+')"><p class="name1">'+contact4.four_name+'<span class="aleft" style="margin-left: 36px;">'+contact4.four_phone+'</span></p>';
                              		appendstr+='<span class="rights2"></span></div><hr>';
                                    $api.attr($api.byId('contact_four'),'style','display:none');
                                    $api.prepend($api.dom('.container'),appendstr);
                        }else{
                            var baseinfo=$api.getStorage('baseinfo');
                             if(baseinfo.contact!=null && baseinfo.contact.four_status==true){
                                var appendstr="";
                                	appendstr+='<div class="con2" tapmode="" onclick="openWin('+"'contact4'"+')"><p class="name1">'+baseinfo.contact.four_name+'<span class="aleft" style="margin-left: 36px;">'+baseinfo.contact.four_name+'</span></p>';
                              		appendstr+='<span class="rights2"></span></div><hr>';
                                    $api.attr($api.byId('contact_four'),'style','display:none');
                                    $api.prepend($api.dom('.container'),appendstr);
                             }
                        };
                        if($api.getStorage('contact3')!='' && $api.getStorage('contact3')!=null){
                            var contact3 = $api.getStorage('contact3');
                              var appendstr="";
                                appendstr+='<div class="con2" tapmode="" onclick="openWin('+"'contact3'"+')"><p class="name1">'+contact3.three_name+'<span class="aleft" style="margin-left: 36px;">'+contact3.three_phone+'</span></p>';
                              	appendstr+='<span class="rights2"></span></div><hr>';
                                $api.attr($api.byId('contact_three'),'style','display:none');
                                $api.prepend($api.dom('.container'),appendstr);
                        }else{
                            var baseinfo=$api.getStorage('baseinfo');
                            if(baseinfo.contact!=null && baseinfo.contact.three_status==true){
                             var appendstr="";
                                    appendstr+='<div class="con2" tapmode="" onclick="openWin('+"'contact3'"+')"><p class="name1">'+baseinfo.contact.three_name+'<span class="aleft" style="margin-left: 36px;">'+baseinfo.contact.three_name+'</span></p>';
                              		appendstr+='<span class="rights2"></span></div><hr>';
                                        $api.attr($api.byId('contact_three'),'style','display:none');
                                        $api.prepend($api.dom('.container'),appendstr);
                            }
                        };
                        if($api.getStorage('contact2')!='' && $api.getStorage('contact2')!=null){
                            var contact2 = $api.getStorage('contact2');
                              var appendstr="";
                                  appendstr+='<div class="con2" tapmode="" onclick="openWin('+"'contact2'"+')"><p class="name1">'+contact2.two_name+'<span class="aleft" style="margin-left: 36px;">'+contact2.two_phone+'</span></p>';
                              	  appendstr+='<span class="rights2"></span></div><hr>';
                                    $api.attr($api.byId('contact_two'),'style','display:none');
                                    $api.prepend($api.dom('.container'),appendstr);
                        }else{
                             var baseinfo=$api.getStorage('baseinfo');
                             if(baseinfo.contact!=null && baseinfo.contact.two_status==true){
                                    var appendstr="";
                                        appendstr+='<div class="con2" tapmode="" onclick="openWin('+"'contact2'"+')"><p class="name1">'+baseinfo.contact.two_name+'<span class="aleft" style="margin-left: 36px;">'+baseinfo.contact.two_name+'</span></p>';
                              		appendstr+='<span class="rights2"></span></div><hr>';
                                        $api.attr($api.byId('contact_two'),'style','display:none');
                                        $api.prepend($api.dom('.container'),appendstr);
                            }
                        };
                        if($api.getStorage('contact1')!='' && $api.getStorage('contact1')!=null){
                              var contact1 = $api.getStorage('contact1');
                              var appendstr="";
                              		appendstr+='<div class="con" tapmode="" onclick="openWin('+"'contact1'"+')" style="text-align:left;"><p class="name1">'+contact1.one_name+'<span class="aleft">'+contact1.one_phone+'</span></p>';
								    appendstr+='<p class="pfon">'+contact1.one_company+'</p><p class="pfon">'+contact1.one_address+'</p><span class="rights"></span></div><hr>';
                                    $api.attr($api.byId('contact_one'),'style','display:none');
                                    $api.prepend($api.dom('.container'),appendstr);
                        }else{
                             var baseinfo=$api.getStorage('baseinfo');
                             if(baseinfo.contact!=null && baseinfo.contact.one_status==true){
                                    var appendstr="";
	                                    appendstr+='<div class="con" tapmode="" onclick="openWin('+"'contact1'"+')"  style="text-align:left;"><p class="name1">'+baseinfo.contact.one_name+'<span class="aleft">'+baseinfo.contact.one_phone+'</span></p>';
									    appendstr+='<p class="pfon">'+baseinfo.contact.one_company+'</p><p class="pfon">'+baseinfo.contact.one_address+'</p><span class="rights"></span></div><hr>';
                                        $api.attr($api.byId('contact_one'),'style','display:none');
                                        $api.prepend($api.dom('.container'),appendstr);
                            }
                        };
	        	
		}
</script>
</html>