<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>添加银行卡</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/common.css" />
  <style type="text/css">
        *{
            margin: 0;
            padding: 0;
        }
        body{
            font-family: "Helvetica Neue", Helvetica, STHeiTi, sans-serif;
            background:#efeff2;
        }
        .brown-border{
        	height:10px;
        	width:100%;
        }
        .card-type{
        	background:#fff;
        	margin-bottom:10px;
        	height:50px;
        	width:100%;
        	border-top:1px solid #D8D8D8;
        	border-bottom:1px solid #D8d8d8;
        }
        .card-type-inner{
        	margin-left:12px;
        	margin-right:12px;
        	line-height:50px;
        	font-size:16px;
        	color:#333333;
        }
        .card-type-inner >input{
        	font-size: 16px;
            width:65%;
            line-height:16px;
            text-indent:39px; 
            font-family:'arial';

            margin-left: 12px;
            outline: none;
        }
        .card-type-font{
        	float:left;
        }
        .card-type-arrow{
        	float:right;
        }
        .brown-border >span{
        	font-size:16px;
        	margin-left:12px;
        	line-height:30px;
        	color:#a1a1a1;
        }
        .addbankform{
        	background:#fff;
            width: 100%;
            height: 150px;
            border-top: 1px solid #D8D8D8;
            border-bottom: 1px solid #D8D8D8;
        }
        .addbankform .kalis{
        	position:relative;
            height: 50px;
            line-height: 46px;
            margin-left: 12px;
            margin-right: 12px;
        }
        .addbankform .kalis .kahao{
            font-size: 16px;
            position:absolute;
        }
        .addbankform .kalis > input{
            font-size: 16px;
            width:100%;
            line-height:50px;
            text-indent:39px; 
            font-family:'arial';

            margin-left: 12px;
            outline: none;
        }
        .icons-div{
        	height: 100%;
		    text-align: center;
		    position: absolute;
		    width: 35px;
        	right:0;
            top:0;
            position:absolute;
        }
        .icons1{
            background: url('../../image/icons1.png') no-repeat;
            width: 20px;
            height: 20px;
            background-position: 50% 40%;
            border-radius: 50%;
            margin-top: 16px;
        }
        .solid{
        	border-bottom:1px solid #EFEFF2;
        }
         #btns{
             width: 100%;
             margin-top: 20px;
        }
        #btns .btn{
             height: 50px;
             margin: 0 20px;
             text-align: center;
             font-size: 18px;
             border-radius: 4px;
             background: #c9c9c9;
             color: #fff;
             line-height: 50px;
        }
    </style>
</head>
<body>
	<div class="brown-border"></div>
	<div class="card-type">
		<div class="card-type-inner">
			<span class="card-type-font">持卡行</span>
			<span class="card-type-arrow">**</span>
			<input type="text" id="card_bank" readonly=""/>
		</div>
	</div>
    <div class="addbankform">
        <div class="kalis solid">
	            <span class="kahao">持卡人</span>
	            <input type="text" id="card_name" placeholder="持卡人姓名" readonly="" />
        </div>
        <div class="kalis solid">
            <span class="kahao">身份证</span>
            <input type="text" id="id_no" placeholder="身份证" maxlength="18"/>
        </div>
        <div class="kalis">
            <span class="kahao">手机号</span>
            <input type="tel" id="card_phone" placeholder="银行卡绑定手机号" maxlength="11"/>
        </div>
        <input type="hidden" id="card_no" />
    </div>
     <div id="btns" tapmode=""  >
      <div class="btn">下一步</div>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/idValidCheck.js"></script>
<script type="text/javascript">
	apiready=function(){
		$api.val($api.byId("card_bank"),api.pageParam.card_bank);
		$api.val($api.byId("card_name"),api.pageParam.card_name);
		$api.val($api.byId("card_no"),api.pageParam.card_no);
		$api.addEvt($api.dom('body'),'input',function(){
			var card_bank=$api.val($api.byId('card_bank'));
			var card_name=$api.val($api.byId('card_name'));
			var id_no=$api.val($api.byId('id_no'));
			var card_phone=$api.val($api.byId('card_phone'));
			if(card_bank!='' && card_name!='' && $api.trimAll(id_no)!='' && $api.trimAll(card_phone)!=''){
				$api.attr($api.dom('.btn'),'style','background:#0da4ff');
				$api.attr($api.dom('.btn'),'onclick','submit()');
			}else{
				$api.attr($api.dom('.btn'),'style','background:#c9c9c9');
				$api.attr($api.dom('.btn'),'onclick','');
			}
		});
	}
	var submit=function(){
			var card_bank=$api.val($api.byId('card_bank'));
			var card_name=$api.val($api.byId('card_name'));
			var id_no=$api.val($api.byId('id_no'));
			var card_no=api.pageParam.card_no;
			var card_phone=$api.val($api.byId('card_phone'));
			if(card_bank==''){
				api.toast({msg:'持卡行未选择！',location:'middle'});
			}else if(card_name==''){
				api.toast({msg:'持卡人未填写！',location:'middle'});
			}else if($api.trimAll(id_no)=='' || $api.trimAll(id_no).length!=18 || IdCardValidate($api.trimAll(id_no))==false){
				api.toast({msg:'身份证格式不对！',location:'middle'});
			}else if($api.trimAll(card_phone)=='' || $api.trimAll(card_phone).length!=11){
				api.toast({msg:'手机号格式不对！',location:'middle'});
			}else{
				api.getPrefs({
	                key:'userid'
                },function(ret,err){
                	if(ret!='' && ret){
                		api.ajax({
			                url:$api.getStorage('request_url')+'/vip/bondcard',
			                method:'post',
			                dataType:'json',
			                returnAll:true,
			                data:{values:{
			                	vipid:ret.value,
			                	bank_name:card_bank,
			                	owner_name:card_name,
			                	card_no:card_no,
			                	id_no:id_no,
			                	card_phone:card_phone
			                }}
		                },function(ret,err){
		                	if(ret){
		                		if(ret.body.result==false && ret.body.msg=='same'){
		                			api.toast({
	                                    msg:'该卡已经绑定，请不要重复添加',
	                                    location:'middle'
                                    });
		                		}else if(ret.body.result==false && ret.body.msg=='fail'){
		                			api.toast({
	                                    msg:'添加失败，请重新添加',
	                                    location:'middle'
                                    });
		                		}else if(ret.body.result==true){
		                			api.toast({
	                                    msg:'添加成功！',
	                                    location:'middle'
                                    });
                                    setTimeout(function(){
                                    	api.execScript({
                                    		name:'mybank',
                                    		frameName:'mybank_body',
	                                        script: 'reload();'
                                        });
                                        api.closeToWin({
                                        	name:'mybank',
                                        	duration:0,
                                        	animation:{
                                        		type:'none'
                                        	}
                                        });
                                    },1000);
		                		}
		                	}
		                });
                	}
                });
				
			}
	}
	

</script>
</html>